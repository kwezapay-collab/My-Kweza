<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin | My Kweza</title>
    <script src="theme.js"></script>
    <link rel="stylesheet" href="index.css">
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.344.0/dist/umd/lucide.min.js"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            width: 90%;
            max-width: 500px;
            padding: 2.5rem;
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .form-row {
            margin-bottom: 1.25rem;
        }

        .form-row label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .form-row input,
        .form-row select {
            width: 100%;
            padding: 0.85rem;
            background: #1e293b;
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: white;
            outline: none;
            transition: all 0.2s;
        }

        .form-row select option {
            background: #1e293b;
            color: white;
        }

        .form-row input:focus,
        .form-row select:focus {
            border-color: var(--accent);
            background: #2d3748;
        }

        .action-btns {
            display: flex;
            gap: 0.75rem;
        }

        .search-filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 10px 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: white;
            outline: none;
            font-size: 0.9rem;
        }

        #memberSearch {
            flex: 2;
            min-width: 250px;
        }

        .btn-flex {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 140px;
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            border-radius: 8px;
        }

        .tab-btn.active {
            color: var(--accent);
            background: rgba(46, 204, 113, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .badge {
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 50%;
            margin-left: 5px;
        }
    </style>
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#1a4d6e">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My Kweza">
    <link rel="apple-touch-icon" href="/icons/kweza-192.png">
</head>

<body class="scrollable super-admin-page">
    <main class="main-content">
        <header class="dashboard-page-header"
            style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1.5rem;">
            <div>
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem;" id="pageTitle">System Management</h1>
                <p style="color: var(--text-muted);" id="pageSubtitle">Financial oversight & system-wide adjustments</p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary btn-flex"
                    onclick="window.myKwezaPageTransition.go('/write-notification.html')">
                    <i data-lucide="bell-plus" style="width: 16px; height: 16px;"></i>
                    <span>Write Notification</span>
                </button>
                <button class="btn btn-secondary btn-flex" onclick="exportCSV()">
                    <i data-lucide="download" style="width: 16px; height: 16px;"></i>
                    <span>Export CSV</span>
                </button>

                <button id="mainActionBtn" class="btn btn-primary btn-flex" onclick="openModal('add')">
                    <i data-lucide="plus" style="width: 20px; height: 20px;"></i>
                    <span>New Record</span>
                </button>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs-container"
            style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 1px solid var(--glass-border); padding-bottom: 1rem;">
            <button class="tab-btn active" onclick="switchTab('system')">System & Payouts</button>
            <button class="tab-btn" onclick="switchTab('users')">User Management</button>
            <button class="tab-btn" onclick="switchTab('revenue')">Revenue Management</button>
            <button class="tab-btn" onclick="switchTab('withdrawals')">Withdrawal Requests <span id="withdrawalBadge"
                    class="badge" style="display:none;">0</span></button>
            <button class="tab-btn" onclick="switchTab('complaints')">Report Complaint</button>
        </div>

        <!-- System Section -->
        <div id="systemSection" class="tab-content active">
            <!-- Financial Summary Cards -->
            <section class="stats-grid animate-fade" style="margin-bottom: 2rem;">
                <div class="glass-card stat-card" style="border-top: 4px solid var(--accent);">
                    <h3>Total Company Revenue</h3>
                    <div class="value">MWK <span id="adminTotalRev">0</span></div>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 5px;">Sum of all recorded revenue
                    </p>
                </div>
                <div class="glass-card stat-card" style="border-top: 4px solid var(--gold);">
                    <h3>Payout Obligations</h3>
                    <div class="value">MWK <span id="adminTotalPay">0</span></div>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 5px;">Total of all salary, bonus,
                        div
                    </p>
                </div>
                <div class="glass-card stat-card" style="border-top: 4px solid var(--primary);">
                    <h3>Remaining Funds</h3>
                    <div class="value">MWK <span id="adminRemaining">0</span></div>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 5px;">Revenue minus Paid amounts
                    </p>
                </div>
            </section>

            <!-- System Settings -->
            <section class="glass-card animate-fade"
                style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1.5rem;">
                    <div class="nav-icon-btn"
                        style="background: rgba(46, 204, 113, 0.1); color: var(--accent); padding: 12px;">
                        <i data-lucide="activity"></i>
                    </div>
                    <div>
                        <h3>Low Revenue Mode (LRM)</h3>
                        <p style="font-size: 0.8rem; color: var(--text-muted);">When active, non-essential payouts
                            default
                            to 'Pending'</p>
                    </div>
                </div>
                <label class="switch" style="cursor: pointer; display: flex; align-items: center; gap: 10px;"
                    onclick="toggleLRM()">
                    <span id="lrmStatusText"
                        style="font-size: 0.8rem; font-weight: 600; color: var(--text-muted);">INACTIVE</span>
                    <i data-lucide="shield-off" id="lrmIcon"
                        style="color: var(--text-muted); width: 32px; height: 32px;"></i>
                </label>
            </section>


            <section class="glass-card animate-fade">
                <div class="search-filter-bar">
                    <input type="text" id="memberSearch" class="filter-input"
                        placeholder="Search by name or member ID...">
                    <select id="filterType" class="filter-input">
                        <option value="all">All Classifications</option>
                        <option value="salary">Basic Salary</option>
                        <option value="bonus">Performance Bonus</option>
                        <option value="dividend">Share Dividend</option>
                        <option value="tax">Tax / Deduction</option>
                    </select>

                    <select id="filterMonth" class="filter-input">
                        <option value="all">All Months</option>
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>

                    <select id="filterYear" class="filter-input">
                        <option value="all">All Years</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                    </select>
                </div>

                <div class="responsive-table-wrap" style="overflow-x: auto;">
                    <table class="mobile-stack" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr
                                style="text-align: left; color: var(--text-muted); font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">
                                <th style="padding-bottom: 1.25rem;">Recipient</th>
                                <th style="padding-bottom: 1.25rem;">Period</th>
                                <th style="padding-bottom: 1.25rem;">Type</th>
                                <th style="padding-bottom: 1.25rem;">Amount</th>
                                <th style="padding-bottom: 1.25rem;">Status</th>
                                <th style="padding-bottom: 1.25rem;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="payoutsTable">
                            <!-- Content populated via super-admin.js -->
                        </tbody>
                    </table>
                </div>
        </div>
        </div>

        <!-- Users Section -->
        <div id="usersSection" class="tab-content">
            <section class="glass-card animate-fade">
                <div class="search-filter-bar">
                    <input type="text" id="userSearch" class="filter-input" placeholder="Search users by name or ID...">
                    <select id="userRoleFilter" class="filter-input">
                        <option value="all">All Roles</option>
                        <option value="Admin">Admin</option>
                        <option value="Super Admin">Super Admin</option>
                        <option value="Founder Member">Founder Member</option>
                        <option value="Share Member">Share Member</option>
                        <option value="Core Team">Core Team</option>
                        <option value="Financial Manager">Financial Manager</option>
                        <option value="Branch Manager">Branch Manager</option>
                        <option value="Branch Member">Branch Member</option>
                        <option value="Dev Operations Assistant">Dev Operations Assistant</option>
                    </select>
                </div>

                <div class="responsive-table-wrap" style="overflow-x: auto;">
                    <table class="mobile-stack" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr
                                style="text-align: left; color: var(--text-muted); font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">
                                <th style="padding-bottom: 1.25rem;">Name & ID</th>
                                <th style="padding-bottom: 1.25rem;">Role</th>
                                <th style="padding-bottom: 1.25rem;">Branch</th>
                                <th style="padding-bottom: 1.25rem;">Salary/Bonus/Div</th>
                                <th style="padding-bottom: 1.25rem;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Revenue Section -->
        <div id="revenueSection" class="tab-content">
            <section class="glass-card animate-fade">
                <div class="search-filter-bar">
                    <input type="text" id="revSearch" class="filter-input" placeholder="Search by source or branch...">
                </div>

                <div class="responsive-table-wrap" style="overflow-x: auto;">
                    <table class="mobile-stack" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr
                                style="text-align: left; color: var(--text-muted); font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">
                                <th style="padding-bottom: 1.25rem;">Source / Branch</th>
                                <th style="padding-bottom: 1.25rem;">Period</th>
                                <th style="padding-bottom: 1.25rem;">Amount</th>
                                <th style="padding-bottom: 1.25rem;">Submitted By</th>
                                <th style="padding-bottom: 1.25rem;">Date</th>
                            </tr>
                        </thead>
                        <tbody id="revenueTable">
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Withdrawals Section -->
        <div id="withdrawalsSection" class="tab-content">
            <section class="glass-card animate-fade">
                <div class="responsive-table-wrap" style="overflow-x: auto;">
                    <table class="mobile-stack" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr
                                style="text-align: left; color: var(--text-muted); font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase;">
                                <th style="padding-bottom: 1.25rem;">Member</th>
                                <th style="padding-bottom: 1.25rem;">Amount</th>
                                <th style="padding-bottom: 1.25rem;">Method & Details</th>
                                <th style="padding-bottom: 1.25rem;">Status</th>
                                <th style="padding-bottom: 1.25rem;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsTable">
                            <!-- Populated via JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <div id="complaintsSection" class="tab-content">
            <section class="glass-card animate-fade" style="max-width: 720px;">
                <h2 style="margin-bottom: 0.8rem;">Report Complaint</h2>
                <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1.5rem;">Send issues directly to
                    the Dev Operations Assistant dashboard.</p>
                <form id="complaintForm">
                    <div class="form-row">
                        <label>Subject</label>
                        <input type="text" id="complaintSubject" placeholder="Short title (optional)">
                    </div>
                    <div class="form-row">
                        <label>Complaint Details</label>
                        <textarea id="complaintMessage" required placeholder="Describe the issue..."
                            style="width: 100%; min-height: 140px; resize: vertical; padding: 0.85rem; background: #1e293b; border: 1px solid var(--glass-border); border-radius: 10px; color: white;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Send Complaint</button>
                </form>
            </section>
        </div>
    </main>

    <!-- Payout Entry Modal -->
    <div id="payoutModal" class="modal">
        <div class="glass-card modal-content">
            <h2 id="modalTitle" style="margin-bottom: 2rem;">Add Payout</h2>
            <form id="payoutForm">
                <input type="hidden" id="payoutId">
                <div class="form-row" id="memberSelectRow">
                    <label>Select Member</label>
                    <select id="userId" required></select>
                </div>
                <div class="form-row">
                    <label>Payment Classification</label>
                    <select id="payoutType" required>
                        <option value="salary">Salary</option>
                        <option value="bonus">Bonus</option>
                        <option value="dividend">Dividend</option>
                        <option value="tax">Tax / Deduction</option>
                    </select>

                </div>
                <div class="form-row">
                    <label>Amount (MWK)</label>
                    <input type="number" id="payoutAmount" required placeholder="0.00" step="0.01">
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <label>Month</label>
                        <select id="payoutMonth" required>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    <div>
                        <label>Year</label>
                        <select id="payoutYear" required>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <label>Current Status</label>
                    <select id="payoutStatus" required>
                        <option value="pending">Pending</option>
                        <option value="paid">Paid</option>
                    </select>
                </div>
                <div style="display: flex; gap: 1.25rem; margin-top: 2.5rem;">
                    <button type="button" class="btn btn-secondary" style="flex: 1;"
                        onclick="closeModal()">Discard</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- User Entry Modal -->
    <div id="userModal" class="modal">
        <div class="glass-card modal-content">
            <h2 id="userModalTitle" style="margin-bottom: 2rem;">Add New User</h2>
            <form id="userForm">
                <input type="hidden" id="editUserId">
                <div class="form-row">
                    <label>Full Name</label>
                    <input type="text" id="userNameInput" required placeholder="John Doe">
                </div>
                <div class="form-row">
                    <label>Member ID (Login ID)</label>
                    <input type="text" id="userMemberIdInput" required placeholder="FON-2025-XXX">
                </div>
                <div class="form-row" id="pinRow">
                    <label>PIN Code (4 digits)</label>
                    <input type="password" id="userPinInput" placeholder="••••" maxlength="4">
                    <small style="color: var(--text-muted);">Only required for new users</small>
                </div>
                <div class="form-row">
                    <label>Role</label>
                    <select id="userRoleInput" required>
                        <option value="Founder Member">Founder Member</option>
                        <option value="Share Member">Share Member</option>
                        <option value="Core Team">Core Team</option>
                        <option value="Financial Manager">Financial Manager</option>
                        <option value="Branch Manager">Branch Manager</option>
                        <option value="Branch Member">Branch Member</option>
                        <option value="Dev Operations Assistant">Dev Operations Assistant</option>
                        <option value="Admin">Admin</option>
                        <option value="Super Admin">Super Admin</option>
                    </select>
                </div>
                <div class="form-row">
                    <label>Branch (if applicable)</label>
                    <input type="text" id="userBranchInput" placeholder="e.g. Blantyre">
                </div>
                <div class="form-row">
                    <label>Email Address</label>
                    <input type="email" id="userEmailInput" placeholder="user@kweza.com">
                </div>
                <div class="form-row" style="display: flex; gap: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="userDividendInput" style="width: auto;">
                        <label for="userDividendInput" style="margin-bottom: 0;">Eligible for Dividends?</label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="userDividendFeeInput" style="width: auto;">
                        <label for="userDividendFeeInput" style="margin-bottom: 0;">Dividend Fee Paid?</label>
                    </div>
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div>
                        <label>Salary (MWK)</label>
                        <input type="number" id="userSalaryInput" placeholder="0.00" step="0.01">
                    </div>
                    <div>
                        <label>Bonus (MWK)</label>
                        <input type="number" id="userBonusInput" placeholder="0.00" step="0.01">
                    </div>
                    <div>
                        <label>Dividends (MWK)</label>
                        <input type="number" id="userDividendsInput" placeholder="0.00" step="0.01">
                    </div>
                </div>
                <div style="display: flex; gap: 1.25rem; margin-top: 2.5rem;">
                    <button type="button" class="btn btn-secondary" style="flex: 1;"
                        onclick="closeUserModal()">Discard</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save User</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Revenue Entry Modal -->
    <div id="revenueModal" class="modal">
        <div class="glass-card modal-content" style="max-width: 450px;">
            <h2 style="margin-bottom: 2rem;">Log Company Revenue</h2>
            <form id="revenueForm">
                <div class="form-row">
                    <label>Amount (MWK)</label>
                    <input type="number" id="revAmount" required placeholder="0.00" step="0.01">
                </div>
                <div class="form-row">
                    <label>Source / Description</label>
                    <input type="text" id="revBranch" placeholder="e.g. Sales Collection, Investors, etc.">
                </div>
                <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                        <label>Month</label>
                        <select id="revMonth" required>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    <div>
                        <label>Year</label>
                        <select id="revYear" required>
                            <option value="2025">2025</option>
                            <option value="2026" selected>2026</option>
                            <option value="2027">2027</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 1.25rem; margin-top: 2.5rem;">
                    <button type="button" class="btn btn-secondary" style="flex: 1;"
                        onclick="closeRevenueModal()">Discard</button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Add Revenue</button>
                </div>
            </form>
        </div>
    </div>

    <script src="responsive-tables.js"></script>
    <script src="super-admin.js"></script>

    <script src='/pwa.js'></script>
</body>

</html>